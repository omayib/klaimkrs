<html lang="en">
  <!-- https://5balloons.info/post-form-data-to-api-using-axios-in-vuejs/ 
    https://5balloons.info/post-form-data-to-api-using-axios-in-vuejs/
    https://codepen.io/edvaldolima/pen/evzWor
    https://gist.github.com/richardblondet/ce87a397ef669d4d25dd21ea02b9dda1
    https://jsfiddle.net/ankurk91/w8y8k5wo/
    https://serversideup.net/uploading-files-vuejs-axios/
-->
  <head>
    <title>Form konversi prodi Informatika 2022</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/vue-loading-overlay@3/dist/vue-loading.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-loading-overlay@3"></script>
    <!-- or point to a specific vue-select release -->
    <script src="https://unpkg.com/vue-select@3.0.0"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/vue-select@3.0.0/dist/vue-select.css"
    />
    <meta name="referrer" content="same-origin" />
    <style lang="scss">
      .swal2-popup {
        font-size: 1.75rem !important;
        font-family: Georgia, serif;
      }
      .mt-2 {
        margin-top: 2.5rem;
      }
      .w-100 {
        width: 100%;
      }
      .panel-warning>.panel-heading {
          color: #4e3a03;
          background-color: #fbba0a;
          border-color: #faebcc;
      }
      .panel-primary>.panel-heading {
          color: #ffffff;
          background-color: #381372;
          border-color: #1a0044;
      }
      .btn-primary {
          color: #fff;
          background-color: #381372;
          border-color: #1a0044;
      }
      .panel-danger>.panel-heading {
          color: #ffffff;
          background-color: #fd3f3f;
          border-color: #ebccd1;
      }
      .btn-primary[disabled]{
          background-color: #242f38;
          border-color: #242f38;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <p style="text-align: center;">
        <img
          src="https://drive.google.com/u/0/uc?id=1UoejSIAkJBIk528CLsNGiU9mumKHm7pE&amp;export=download"
          alt=""
          width="750"
        />
      </p>
      <h1 style="text-align: center;">PENGAJUAN KLAIM KONVERSI SKS - MBKM</h1>
      <p style="text-align: center;">Aplikasi BIMA 1.0.4</p>
      <p style="text-align: center;"><em>Pastikan koneksi internet Anda stabil dan kencang. Pada proses unggah file mungkin akan memakan waktu.</em></p>
    </div>
    <main class="container" id="app">
      <loading :active.sync="visible" :can-cancel="true"></loading>
      <div class="panel-group">
        <div class="panel panel-warning">
          <div class="panel-heading">PENCARIAN</div>
          <div class="panel-body">
            <div class="input-group input-group-lg">
              <input
                v-model="access_id"
                placeholder="Surat Tugas"
                class="form-control"
                @keyup.enter="onClickButtonCari"
              />
              <span class="input-group-btn">
                <button v-on:click="onClickButtonCari" class="btn btn-success">
                  Cari
                </button>
              </span>
            </div>
            <p class="text-muted" v-show="access_id_message">
              Nomor Surat Tugas. {{ access_id_message }}
            </p>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-6">
          <!-- Step 1 -->
          <div class="panel-group">
            <div class="panel panel-primary">
              <div class="panel-heading">STEP 1. PROFIL PESERTA</div>
              <div class="panel-body">
                <form v-on:submit.prevent="submitEntry">
                  <div class="row">
                    <div class="container-fluid">
                      <div class="form-group">
                        <label>Nama</label>
                        <input
                          type="text"
                          class="form-control"
                          v-model="profileDraft.name"
                          placeholder="Nama lengkap"
                        />
                      </div>

                      <div class="form-group">
                        <label>NIM</label>
                        <input
                          type="text"
                          v-model="profileDraft.nim"
                          placeholder="19.11.1155x"
                          class="form-control"
                        />
                      </div>

                      <div class="form-group">
                        <label>No. Surat Tugas</label>
                        <input
                          type="text"
                          class="form-control"
                          v-model="profileDraft.no_surat"
                          placeholder="contoh : 01/FIK/BANGKIT/2022"
                        />
                      </div>

                      <div class="form-group">
                        <label>Email</label>
                        <input
                          type="text"
                          class="form-control"
                          v-model="profileDraft.email"
                          placeholder="stefani@students.amikom.ac.id"
                        />
                      </div>

                      <div class="form-group">
                        <label>Kegiatan</label>
                        <v-select
                          :options="opsiKegiatan"
                          label="title"
                          v-model="profileDraft.kegiatan"
                        ></v-select>
                      </div>

                      <div class="form-group">
                        <label>Dosen Pendamping</label>
                        <v-select
                          :options="dosen"
                          label="name"
                          v-model="dosenTerpilih"
                        ></v-select>
                      </div>
                    </div>
                  </div>

                  <div class="form-group">
                    <button class="btn btn-primary">SIMPAN</button>
                  </div>
                </form>
                <p class="text-muted">
                  Petunjuk : Silahkan isikan form diatas ini secara lengkap. Bila tidak memiliki dosen pendamping, silakan pilih dosen wali Anda.
                </p>
              </div>
            </div>
          </div>
          <!-- End of Step 1 -->
        </div>
        <div class="col-lg-6">
          <!-- Step 2 -->
          <div class="panel-group">
            <div class="panel panel-primary">
              <div class="panel-heading">STEP 2. UNGGAH BUKTI KEGIATAN</div>
              <div class="panel-body">
                <div class="container">
                  <label
                    >File Sertifikat
                    <input
                      type="file"
                      @change="handleFileUploadSertifikat( $event )"
                    />
                  </label>
                  <button
                    class="btn btn-primary"
                    @click="submitFileSertifikat"
                    :disabled="profileIsEmpty()"
                  >
                    SIMPAN
                  </button>
                  <button
                    class="btn btn-primary"
                    v-if="(fileUrlSertifikat)"
                    @click="openSertifikat"
                  >
                    <i class="fa fa-eye"></i> LIHAT
                  </button>
                </div>
                <div class="container mt-2">
                  <label
                    >File Kontrak Konversi
                    <input
                      type="file"
                      @change="handleFileUploadKontrak( $event )"
                    />
                  </label>
                  <button
                    class="btn btn-primary"
                    @click="submitFileKontrak"
                    :disabled="profileIsEmpty()"
                  >
                    SIMPAN
                  </button>
                  <button
                    class="btn btn-primary"
                    v-if="(fileUrlKontrakKonversi)"
                    @click="openKontrakKonversi"
                  >
                    <i class="fa fa-eye"></i> LIHAT
                  </button>
                </div>

                <div class="container mt-2">
                  <label
                    >File Surat Rekomendasi
                    <input
                      type="file"
                      @change="handleFileUploadSuratRekomendasi( $event )"
                    />
                  </label>
                  <button
                    class="btn btn-primary"
                    @click="submitFileSuratRekomendasi"
                    :disabled="profileIsEmpty()"
                  >
                    SIMPAN
                  </button>
                  <button
                    class="btn btn-primary"
                    v-if="(fileUrlSuratRekomendasi)"
                    @click="openSuratRekomendasi"
                  >
                    <i class="fa fa-eye"></i> LIHAT
                  </button>
                </div>

                <div class="container mt-2">
                  <label
                    >File Laporan
                    <input
                      type="file"
                      @change="handleFileUploadLaporan( $event )"
                    />
                  </label>
                  <button
                    class="btn btn-primary"
                    @click="submitFileLaporan"
                    :disabled="profileIsEmpty()"
                  >
                    SIMPAN
                  </button>
                  <button
                    class="btn btn-primary"
                    v-if="(fileUrlLaporan)"
                    @click="openLaporan"
                  >
                    <i class="fa fa-eye"></i> LIHAT
                  </button>
                </div>
                <div class="container mt-2">
                  <label
                    >File Nilai
                    <input
                      type="file"
                      @change="handleFileUploadNilai( $event )"
                    />
                  </label>
                  <button
                    class="btn btn-primary"
                    @click="submitFileNilai"
                    :disabled="profileIsEmpty()"
                  >
                    SIMPAN
                  </button>
                  <button
                    class="btn btn-primary"
                    v-if="(fileUrlNilai)"
                    @click="openNilai"
                  >
                    <i class="fa fa-eye"></i> LIHAT
                  </button>
                </div>

                <div class="container mt-2">
                  <label
                    >File KHS
                    <input
                      type="file"
                      @change="handleFileUploadKhs( $event )"
                    />
                  </label>
                  <button
                    class="btn btn-primary"
                    @click="submitFileKhs"
                    :disabled="profileIsEmpty()"
                  >
                    SIMPAN
                  </button>
                  <button
                    class="btn btn-primary"
                    v-if="(fileUrlKhs)"
                    @click="openKhs"
                  >
                    <i class="fa fa-eye"></i> LIHAT
                  </button>
                </div>
                <p class="text-muted" style="padding: 20px 10px 0px;">
                  Petunjuk : Silahkan upload file dengan menekan tombol
                  "SIMPAN", pastikan file diupload sesuai pada form yang
                  tersedia.
                  <ul>
                    <li>
                      <strong>File Sertifikat</strong><br>
                      Sertifikat yang Anda dapatkan selesai mengikuti kegiatan MBKM.
                      <a href="https://drive.google.com/file/d/1zmOyWiAQH7MdOsZG9cGZk9IuxGgEpO3u/view" target="_blank">Lihat contoh ini.</a>
                    </li>
                    <li>
                      <strong>File Kontrak Konversi</strong><br>
                      Lembar usulan konversi yang sudah disetujui oleh Dosen Wali / Kaprodi. 
                      <a href="https://drive.google.com/file/d/1gKXhNGC_1KhO-n0L7q0gBchAgCBn5U2O/view" target="_blank">Lihat contoh ini.</a>
                    </li>
                    <li>
                      <strong>File Surat Rekomendasi</strong><br>
                      Bukti surat rekomendasi dari Fakultas.
                      <a href="https://drive.google.com/file/d/1jQZRSfmlfiGaZR_uEdv9QFwtuShNp3gi/view" target="_blank">Lihat contoh ini.</a>
                    </li>
                    <li>
                      <strong>File Laporan</strong><br>
                      Dokumen laporan kegiatan MBKM yang Anda ikuti. Bila kegiatan yang Anda ikuti telah memiliki standar laporan, silakan langsung diunggah. Namun bila belum, Anda wajib membuat dengan mengikuti format berikut. 
                      <a href="https://docs.google.com/document/d/1BIbupjleze3C9fH7jVU1jw5-tPZhO54Re-MxJwRC0pA/view" target="_blank">Lihat contoh ini.</a> 
                    </li>
                    <li>
                      <strong>File Nilai</strong><br>
                      Bukti nilai yang dikeluarkan oleh mitra MBKM (Penyelenggara Kegiatan)
                      <a href="https://drive.google.com/file/d/1_RKVOoX1hd0RvQkzOicH9FXkOv2qZpiK/view" target="_blank">Lihat contoh ini.</a>
                    </li>
                    <li>
                      <strong>File KHS</strong><br>
                      Lampirkan screenshoot KHS semester berjalan saat ini sebagai bukti bahwa matakuliah konversi sudah diambil saat KRS-an. 
                     </li>
                  </ul>
                </p>
              </div>
            </div>
          </div>
          <!-- End of Step 2 -->
        </div>
      </div>

      <div class="panel-group">
        <div class="panel panel-primary">
          <div class="panel-heading">STEP 3. FORM KONVERSI</div>
          <div class="panel-body">
            <button
              class="btn btn-primary pull-right"
              @click="addRow"
              style="margin-bottom: 10px;"
            >
              <i class="fa fa-plus"></i> tambah baris
            </button>
            <form v-on:submit.prevent="submitForm">
              <table class="table table-bordered">
                <thead class="text text-success">
                  <tr>
                    <th>Objective</th>
                    <th>Durasi</th>
                    <th>Kode Matkul</th>
                    <th>Nama Matkul</th>
                    <th>SKS Matkul</th>
                    <th>Nilai Angka</th>
                    <th>Nilai Huruf</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(user, index) in items">
                    <td>
                      <textarea
                        v-model="user.objective"
                        class="form-control"
                        type="text"
                        :disabled="user.status==='delete'">
                      </textarea> 
                    </td>
                    <td>
                      <input
                        v-model="user.durasi"
                        class="form-control"
                        type="number"
                        :disabled="user.status==='delete'"
                      />
                    </td>
                    <td>
                      <input
                        v-model="user.kode"
                        class="form-control"
                        type="text"
                        :disabled="user.status==='delete'"
                      />
                    </td>
                    <td>
                      <input
                        v-model="user.matkul"
                        class="form-control"
                        type="text"
                        :disabled="user.status==='delete'"
                      />
                    </td>
                    <td>
                      <input
                        v-model="user.sks"
                        class="form-control"
                        type="number"
                        :disabled="user.status==='delete'"
                      />
                    </td>
                    <td>
                      <input
                        v-model="user.angka"
                        class="form-control"
                        type="number"
                        :disabled="user.status==='delete'"
                      />
                    </td>
                    <td>
                      <input
                        v-model="user.huruf"
                        class="form-control"
                        type="text"
                        :disabled="user.status==='delete'"
                      />
                    </td>
                    <td>
                      <i
                        @click="deleteRow(index)"
                        class="fa fa-remove"
                        style="font-size: 25px; color: red; cursor: pointer;"
                      ></i>
                    </td>
                  </tr>
                </tbody>
              </table>

              <div class="form-group">
                <button class="btn btn-primary" :disabled="profileIsEmpty()">
                  SIMPAN
                </button>
              </div>
            </form>
            <p class="text-muted" style="padding: 20px 10px 0px;">
              Petunjuk : Tambahkan baris untuk mengisi form konversi, kemudian klik simpan untuk menyimpan data. Perhatikan hal berikut.
            <br>
              <ul>
                <li>
                  <strong>Objective</strong> :  Masukkan objective kegiatan MBKM yang telah Anda ikuti.
                </li>
                <li>
                  <strong>Durasi</strong> : Masukkan durasi kegiatan masing-masing objective yang telah Anda ikuti.
                </li>
                <li>
                  <strong>Kode Matkul</strong> : Tuliskan kode matkul prodi Inforomatika AMIKOM yang dikonversi. Biasanya diawali dengan huruf STxxx.
                </li>
                <li>
                  <strong>Nama Matkul</strong> :  Tuliskan nama mata kuliah prodi Inforomatika AMIKOM yang dikonversi. 
                </li>
                <li>
                  <strong>Nilai Angka</strong> :  Masukan nilai angka yang anda dapatkan dari kegiatan MBKM pada objective tersebut.
                </li>
                <li>
                  <strong>Nilai Huruf</strong> :  Masukan nilai huruf dengan acuan berikut. Bulatkan keatas bila mengandung desimal.
                  <ul>
                    <li>
                      rentang 81-100 setara dengan nilai huruf A
                    </li>
                    <li>
                      rentang 61-80 setara dengan nilai huruf B
                    </li>
                    <li>
                      rentang 41-60 setara dengan nilai huruf C
                    </li>
                    <li>
                      rentang 21-40 setara dengan nilai huruf D
                    </li>
                    <li>
                      rentang 0-20 setara dengan nilai huruf E
                    </li>
                  </ul>
                </li>
                <li>
                  Apabila ternyata format nilai yang dikeluarkan berbeda dengan format kontrak konversi yang disetujui oleh Prodi Informatika, Silakan <a href="https://drive.google.com/file/d/1V7X7cRMk_1t068IUm_y9pcVQXYLLqXGd/view" target="_blank">ikuti panduan ini.</a>
                </li>
              </ul>
            </p>
          </div>
        </div>
      </div>
      <div class="panel-group">
        <div class="panel panel-danger">
          <div class="panel-heading">STEP 4. SUBMISION</div>
          <div class="panel-body">
            <label class="w-100">
              <input
                type="checkbox"
                class="text-muted"
                v-model="checkdata"
                true-value="true"
                false-value="false"
              />
              Saya telah melakukan pengecekan ulang pada data diatas dan dengan
              ini menyatakan data yang saya kirimkan sudah benar.
            </label>
            <button
              class="btn btn-danger"
              v-on:click="onClickButtonSubmit"
              :disabled="checkdata=='false'?'':disabled"
            >
              SIMPAN PERMANEN
            </button>
          </div>
        </div>
      </div>
    </main>
    <script>
      Vue.use(VueLoading);
      Vue.component("v-select", VueSelect.VueSelect);
      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
      });
      var key =
        "AKfycbz7BEPbA3K7n6pySb2VC95R_edqktiDUtUNb4W5yblVDRyjLFRopFbrcfgZfz0zOldx"; //"AKfycbyC8gSkitA2FN3n3DZziIMJla_4xSDRel5SEDiDNMmNXaI00Oa98Th-mWDC3N12YefX";
      var baseUrl = "https://script.google.com/macros/s/" + key + "/exec";
      var app = new Vue({
        el: "#app",
        data: {
          opsiKegiatan: [
            "Studi Independen",
            "Magang Bersertifikat",
            "Bangkit",
            "Pertukaran Pelajar",
          ],
          fileUrlSertifikat: "",
          fileUrlKontrakKonversi: "",
          fileUrlSuratRekomendasi: "",
          fileUrlLaporan: "",
          fileUrlNilai: "",
          fileUrlKhs: "",
          fileSertifikat: "",
          fileKontrak: "",
          fileSuratRekomendasi: "",
          fileLaporan: "",
          fileNilai: "",
          fileKhs: "",
          visible: false,
          access_id: "",
          access_id_message: "001/FIK-IF/AMIKOM/REK.STUIND/07/2021",
          dosen: [{ name: "", email: "" }],
          dosenTerpilih: { name: "", email: "" },
          profileDraft: {
            name: "",
            nim: "",
            kegiatan: "",
            email: "",
            no_surat: "",
          },
          profile: { name: "", nim: "", kegiatan: "", email: "", no_surat: "" },
          items: [],
          checkdata: "false",
        },
        mounted() {
          console.log("mounted");
          this.fetchOpsiKegiatan();
          this.fetchDosen();
        },
        components: {
          Loading: VueLoading,
        },
        methods: {
          fetchOpsiKegiatan,
          openSertifikat: function () {
            window.open(app.fileUrlSertifikat, "_blank");
          },
          openKontrakKonversi: function () {
            window.open(app.fileUrlKontrakKonversi, "_blank");
          },
          openSuratRekomendasi: function () {
            window.open(app.fileUrlSuratRekomendasi, "_blank");
          },
          openLaporan: function () {
            window.open(app.fileUrlLaporan, "_blank");
          },
          openNilai: function () {
            window.open(app.fileUrlNilai, "_blank");
          },
          openKhs: function () {
            window.open(app.fileUrlKhs, "_blank");
          },
          onClickButtonSubmit,
          profileIsEmpty,
          submitEntry,
          addRow: function () {
            var randomId = Math.floor(100000 + Math.random() * 900000);
            this.items.push({
              id: randomId,
              objective: "",
              durasi: "",
              kode: "",
              matkul: "",
              sks: "",
              angka: "",
              huruf: "",
              email: app.profile.email,
              no_surat: app.profile.no_surat,
              status: "",
            });
            console.log("add " + this.items);
          },
          deleteRow(index) {
            Swal.fire({
              title: "Yakin dihapus?",
              text: "Proses tidak bisa diualng",
              icon: "warning",
              showCancelButton: true,
              confirmButtonColor: "#3085d6",
              cancelButtonColor: "#d33",
              confirmButtonText: "Ya, hapus!",
            }).then((result) => {
              if (result.isConfirmed) {
                var item = this.items[index];
                item.status = "delete";
                Vue.set(this.items, index, item);

                Swal.fire(
                  "Deleted!",
                  "SKS Konversi berhasil dihapus.",
                  "success"
                );
              }
            });
            // var item = this.items[index];
            // item.status='delete'
            // Vue.set(this.items,index,item)
          },
          submitForm,
          onClickButtonCari,
          submitFileKontrak,
          submitFileSertifikat,
          submitFileSuratRekomendasi,
          submitFileLaporan,
          submitFileNilai,
          submitFileKhs,
          fetchDosen,
          handleFileUploadSertifikat(event) {
            this.fileSertifikat = event.target.files[0];
          },
          handleFileUploadKontrak(event) {
            this.fileKontrak = event.target.files[0];
          },
          handleFileUploadSuratRekomendasi(event) {
            this.fileSuratRekomendasi = event.target.files[0];
          },
          handleFileUploadLaporan(event) {
            this.fileLaporan = event.target.files[0];
          },
          handleFileUploadNilai(event) {
            this.fileNilai = event.target.files[0];
          },
          handleFileUploadKhs(event) {
            this.fileKhs = event.target.files[0];
          },
        },
      });
      function submitEntry() {
        var urlProfile = baseUrl + "?action=8";
        var dataTobeUpload = {
          nama: this.profileDraft.name,
          email: this.profileDraft.email,
          nim: this.profileDraft.nim,
          kegiatan: this.profileDraft.kegiatan,
          no_surat: this.profileDraft.no_surat,
          dosen_nama: this.dosenTerpilih.name,
          dosen_email: this.dosenTerpilih.email,
        };
        if (
          this.profileDraft.name === "" ||
          this.profileDraft.email === "" ||
          this.profileDraft.nim === "" ||
          this.profileDraft.kegiatan === "" ||
          this.profileDraft.no_surat === "" ||
          this.dosenTerpilih.email === ""
        ) {
          Swal.fire("Ops!", "data masih kosong", "error");
        } else {
          Swal.fire({
            title: "Data akan disimpan?",
            text: "Periksa dengan teliti",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Ya, Submit",
          }).then((result) => {
            if (result.isConfirmed) {
              let loader = this.$loading.show({
                loader: "dots",
              });
              axios({
                method: "post",
                url: urlProfile,
                data: dataTobeUpload,
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                "Access-Control-Allow-Origin": "*",
              })
                .then(function (response) {
                  //handle success
                  loader.hide();
                  var _profil = response.data.data;
                  console.log(_profil);
                  if (_profil) {
                    Toast.fire({
                      icon: "success",
                      title: "Profil berhasil diperbarui",
                    });

                    app.profile.name = _profil.nama;
                    app.profile.nim = _profil.nim;
                    app.profile.kegiatan = _profil.kegiatan;
                    app.profile.email = _profil.email;
                    app.profile.no_surat = _profil.no_surat;

                    app.profileDraft.name = _profil.nama;
                    app.profileDraft.nim = _profil.nim;
                    app.profileDraft.kegiatan = _profil.kegiatan;
                    app.profileDraft.email = _profil.email;
                    app.profileDraft.no_surat = _profil.no_surat;
                  } else {
                    clearProfile();
                  }
                })
                .catch(function (response) {
                  //handle error
                  console.log(response);
                  loader.hide();
                });
            }
          });
        }
      }
      function onClickButtonCari() {
        let loader = this.$loading.show({
          loader: "dots",
        });
        var urlProfile = baseUrl + "?action=1&sr=" + app.access_id;
        var urlKonversi = baseUrl + "?action=2&sr=" + app.access_id;
        let endpoints = [urlProfile, urlKonversi];
        axios
          .all(endpoints.map((endpoint) => axios.get(endpoint)))
          .then(
            axios.spread((profile, konversi) => {
              loader.hide();
              if (profile.data.data.length > 0) {
                var _profil = profile.data.data.shift();
                console.log(_profil);
                app.profile.name = _profil.nama;
                app.profile.nim = _profil.nim;
                app.profile.kegiatan = _profil.jenis_rekomendasi;
                app.profile.email = _profil.email;
                app.profile.no_surat = _profil.no_surat;
                app.dosenTerpilih.name = _profil.dosen_nama;
                app.dosenTerpilih.email = _profil.dosen_email;
                app.fileUrlKontrakKonversi = _profil.bukti_kontrak_konversi;
                app.fileUrlSertifikat = _profil.bukti_sertifikat;
                app.fileUrlSuratRekomendasi = _profil.bukti_rekomendasi;
                app.fileUrlLaporan = _profil.bukti_laporan;
                app.fileUrlNilai = _profil.bukti_nilai;
                app.fileUrlKhs = _profil.bukti_khs;

                app.profileDraft.name = _profil.nama;
                app.profileDraft.nim = _profil.nim;
                app.profileDraft.kegiatan = _profil.jenis_rekomendasi;
                app.profileDraft.email = _profil.email;
                app.profileDraft.no_surat = _profil.no_surat;
              } else {
                clearProfile();
                Swal.fire(
                  "Ops!",
                  "Profile tidak ditemukan. Lengkapi STEP 1",
                  "error"
                );
              }
              if (konversi.data.data.length > 0) {
                var _items = konversi.data.data;
                app.items = [];
                _items.forEach(function (e, i) {
                  app.items.push({
                    id: e.id,
                    objective: e.objective,
                    durasi: e.durasi,
                    kode: e.kode_makul,
                    sks: e.sks,
                    matkul: e.makul,
                    angka: e.angka,
                    huruf: e.huruf,
                    email: e.email,
                    no_surat: e.no_surat,
                  });
                });
              }
            })
          )
          .catch(function (error) {
            // handle error
            console.log(error);
            loader.hide();
          })
          .then(function () {});
      }
      function submitForm() {
        // var baseUrl = `https://script.google.com/macros/s/${app.key}/exec`

        // var urlKonversi = app.baseUrl+"?action=insert";
        var urlKonversi = baseUrl + "?action=6";
        var payload = { items: app.items, profile: app.profile };
        console.log("payload");

        Swal.fire({
          title: "Data akan disimpan?",
          text: "Periksa dengan teliti",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Ya, Submit",
        }).then((result) => {
          if (result.isConfirmed) {
            let loader = this.$loading.show({
              loader: "dots",
            });
            axios({
              method: "post",
              url: urlKonversi,
              data: app.items,
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              "Access-Control-Allow-Origin": "*",
            })
              .then(function (response) {
                //handle success
                console.log(response);
                loader.hide();
                Toast.fire({
                  icon: "success",
                  title: "Konversi berhasil diperbarui",
                });
              })
              .catch(function (response) {
                //handle error
                console.log(response);
                Swal.fire(
                  "Ops!",
                  "Terjadi kesalahan, mungkin nomer surat tidak valid",
                  "error"
                );
                loader.hide();
              });
          }
        });
      }
      function submitFileSertifikat() {
        if (!this.fileSertifikat) {
          Swal.fire("Ops!", "File sertifikat belum dipilih", "error");
          return;
        }
        let loader = this.$loading.show({
          loader: "dots",
        });
        const qs = new URLSearchParams({
          filename: this.fileSertifikat.name,
          mimeType: this.fileSertifikat.type,
          action: 7,
          noSurat: this.profile.no_surat,
          jenis: "sertifikat",
        });
        const fr = new FileReader();
        fr.readAsArrayBuffer(this.fileSertifikat);
        fr.onload = (f) => {
          axios({
            method: "post",
            url: baseUrl + "?" + qs,
            data: JSON.stringify([...new Int8Array(f.target.result)]),
          })
            .then(function (r) {
              app.fileUrlSertifikat = r.data.data.fileUrl;
              loader.hide();
              Swal.fire(
                "Good job!",
                "Kamu berhasil mengunngah sertifikat",
                "success"
              );
            })
            .then((re) => {
              loader.hide();
              console.log(re);
            })
            .catch((error) => {
              loader.hide();
              Swal.fire(
                "Ops!",
                "Terjadi kesalahan, mungkin nomer surat tidak valid",
                "error"
              );
            });
        };
      }
      function submitFileKontrak() {
        if (!this.fileKontrak) {
          Swal.fire("Ops!", "File kontrak konversi belum dipilih", "error");
          return;
        }
        let loader = this.$loading.show({
          loader: "dots",
        });
        const qs = new URLSearchParams({
          filename: this.fileKontrak.name,
          mimeType: this.fileKontrak.type,
          action: 7,
          noSurat: this.profile.no_surat,
          jenis: "kontrakkonversi",
        });
        const fr = new FileReader();
        fr.readAsArrayBuffer(this.fileKontrak);
        fr.onload = (f) => {
          axios({
            method: "post",
            url: baseUrl + "?" + qs,
            data: JSON.stringify([...new Int8Array(f.target.result)]),
          })
            .then(function (r) {
              app.fileUrlKontrakKonversi = r.data.data.fileUrl;
              loader.hide();
              Swal.fire(
                "Good job!",
                "Kamu berhasil mengunngah kontrak konversi",
                "success"
              );
            })
            .catch((error) => {
              loader.hide();
              Swal.fire(
                "Ops!",
                "Terjadi kesalahan, mungkin nomer surat tidak valid",
                "error"
              );
            });
        };
      }
      function submitFileSuratRekomendasi() {
        if (!this.fileSuratRekomendasi) {
          Swal.fire(
            "Ops!",
            "File surat rekomendasi konversi belum dipilih",
            "error"
          );
          return;
        }
        let loader = this.$loading.show({
          loader: "dots",
        });
        const qs = new URLSearchParams({
          filename: this.fileSuratRekomendasi.name,
          mimeType: this.fileSuratRekomendasi.type,
          action: 7,
          noSurat: this.profile.no_surat,
          jenis: "suratrekomendasi",
        });
        const fr = new FileReader();
        fr.readAsArrayBuffer(this.fileSuratRekomendasi);
        fr.onload = (f) => {
          axios({
            method: "post",
            url: baseUrl + "?" + qs,
            data: JSON.stringify([...new Int8Array(f.target.result)]),
          })
            .then(function (r) {
              app.fileUrlSuratRekomendasi = r.data.data.fileUrl;
              loader.hide();
              Swal.fire(
                "Good job!",
                "Kamu berhasil mengunngah surat rekomendasi",
                "success"
              );
            })
            .catch((error) => {
              loader.hide();
              Swal.fire(
                "Ops!",
                "Terjadi kesalahan, mungkin nomer surat tidak valid",
                "error"
              );
            });
        };
      }
      function submitFileLaporan() {
        if (!this.fileLaporan) {
          Swal.fire(
            "Ops!",
            "File surat rekomendasi konversi belum dipilih",
            "error"
          );
          return;
        }
        let loader = this.$loading.show({
          loader: "dots",
        });
        const qs = new URLSearchParams({
          filename: this.fileLaporan.name,
          mimeType: this.fileLaporan.type,
          action: 7,
          noSurat: this.profile.no_surat,
          jenis: "laporan",
        });
        const fr = new FileReader();
        fr.readAsArrayBuffer(this.fileLaporan);
        fr.onload = (f) => {
          axios({
            method: "post",
            url: baseUrl + "?" + qs,
            data: JSON.stringify([...new Int8Array(f.target.result)]),
          })
            .then(function (r) {
              app.fileUrlLaporan = r.data.data.fileUrl;
              loader.hide();
              Swal.fire(
                "Good job!",
                "Kamu berhasil mengunggah laporan",
                "success"
              );
            })
            .catch((error) => {
              loader.hide();
              Swal.fire(
                "Ops!",
                "Terjadi kesalahan, mungkin nomer surat tidak valid",
                "error"
              );
            });
        };
      }
      function submitFileNilai() {
        if (!this.fileNilai) {
          Swal.fire(
            "Ops!",
            "File surat rekomendasi konversi belum dipilih",
            "error"
          );
          return;
        }
        let loader = this.$loading.show({
          loader: "dots",
        });
        const qs = new URLSearchParams({
          filename: this.fileNilai.name,
          mimeType: this.fileNilai.type,
          action: 7,
          noSurat: this.profile.no_surat,
          jenis: "nilai",
        });
        const fr = new FileReader();
        fr.readAsArrayBuffer(this.fileNilai);
        fr.onload = (f) => {
          axios({
            method: "post",
            url: baseUrl + "?" + qs,
            data: JSON.stringify([...new Int8Array(f.target.result)]),
          })
            .then(function (r) {
              app.fileUrlNilai = r.data.data.fileUrl;
              loader.hide();
              Swal.fire(
                "Good job!",
                "Kamu berhasil mengunggah laporan",
                "success"
              );
            })
            .catch((error) => {
              loader.hide();
              Swal.fire(
                "Ops!",
                "Terjadi kesalahan, mungkin nomer surat tidak valid",
                "error"
              );
            });
        };
      }
      function submitFileKhs() {
        if (!this.fileKhs) {
          Swal.fire(
            "Ops!",
            "File surat rekomendasi konversi belum dipilih",
            "error"
          );
          return;
        }
        let loader = this.$loading.show({
          loader: "dots",
        });
        const qs = new URLSearchParams({
          filename: this.fileKhs.name,
          mimeType: this.fileKhs.type,
          action: 7,
          noSurat: this.profile.no_surat,
          jenis: "khs",
        });
        const fr = new FileReader();
        fr.readAsArrayBuffer(this.fileKhs);
        fr.onload = (f) => {
          axios({
            method: "post",
            url: baseUrl + "?" + qs,
            data: JSON.stringify([...new Int8Array(f.target.result)]),
          })
            .then(function (r) {
              app.fileUrlKhs = r.data.data.fileUrl;
              loader.hide();
              Swal.fire(
                "Good job!",
                "Kamu berhasil mengunggah laporan",
                "success"
              );
            })
            .catch((error) => {
              loader.hide();
              Swal.fire(
                "Ops!",
                "Terjadi kesalahan, mungkin nomer surat tidak valid",
                "error"
              );
            });
        };
      }
      function clearProfile() {
        app.profile.name = "";
        app.profile.email = "";
        app.profile.nim = "";
        app.profile.kegiatan = "";
        app.profile.no_surat = "";
      }
      function profileIsEmpty() {
        return this.profile.email === "" || this.profile.no_surat === "";
      }
      function fetchDosen() {
        const qs = new URLSearchParams({ action: 5 });
        const url = baseUrl + "?" + qs;
        axios.get(url)
            .then(result=>{
                var _dosen = result.data.data;
                if(_dosen.length>0){
                        app.dosen = [];
                        _dosen.forEach((e, i) => {
                          app.dosen.push({ name: e.nama_dosen, email: e.email_dosen });
                        });
                }else{
                  console.log("data dosen tidak ditemukan");
                }
            })
            .catch(error =>{
                console.log(error);})
      }
      function onClickButtonSubmit() {
        var urlReview = baseUrl + "?action=10";
        var dataTobeUpload = {
          no_surat: app.profile.no_surat,
          dosen_email: app.dosenTerpilih.email,
          mahasiswa_email: app.profile.email,
          review_status: "PENDING",
          review_feedback: app.feedback,
        };
        Swal.fire({
          title: "Pengajuan akan di review oleh dosen",
          text: "Periksa dengan teliti dan hasilnya dapat anda lihat di email",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Ya, Submit",
        }).then((result) => {
          if (result.isConfirmed) {
            let loader = this.$loading.show({
              loader: "dots",
            });
            axios({
              method: "post",
              url: urlReview,
              data: dataTobeUpload,
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              "Access-Control-Allow-Origin": "*",
            })
              .then(function (response) {
                //handle success
                loader.hide();
                console.log(response);
                if (response.data.status) {
                  Toast.fire({
                    icon: "success",
                    title: "Review berhasil diperbarui",
                  });
                } else {
                  Toast.fire({
                    icon: "error",
                    title: "Review gagal diperbarui",
                  });
                }
              })
              .catch(function (response) {
                //handle error
                console.log(response);
                loader.hide();
                Toast.fire({
                  icon: "error",
                  title: "Review gagal diperbarui",
                });
              });
          }
        });
      }

      function fetchOpsiKegiatan() {
        var urlKegiatan = baseUrl + "?action=12";
        axios
          .get(urlKegiatan)
          .then((result) => {
            const items = result.data.data;
            if (items.length > 0) {
              app.opsiKegiatan = [];
              items.forEach((item, i) => {
                app.opsiKegiatan.push(item.kegiatan);
              });
            }
          })
          .catch((error) => {
            console.log(error);
          });
      }
    </script>
  </body>
</html>
